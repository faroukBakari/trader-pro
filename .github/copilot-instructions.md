Purpose
This file contains step-by-step instructions and examples to bootstrap a small FastAPI API server with a single healthcheck endpoint using Test Driven Development. It covers project layout, virtual environment isolation, dev dependencies, TDD workflow with pytest, OpenAPI client and docs generation, git initialization, and a GitHub Actions workflow that runs tests on push.

Quick overview
- Build with FastAPI and Uvicorn.
- Use TDD: write pytest tests first, implement the feature, run tests.
- Isolate environment with either Python venv + pip or Poetry.
- Autogenerate client from OpenAPI spec and host autogenerated docs.
- CI runs pytest and linters on push using GitHub Actions.
- Enforce code quality with pre-commit hooks and standard formatters.

Recommended project layout
my-api/
├─ .github/
│  └─ workflows/
│     └─ ci.yml
├─ src/
│  └─ my_api/
│     ├─ __init__.py
│     ├─ main.py
│     └─ api/
│        └─ health.py
├─ tests/
│  └─ test_health.py
├─ pyproject.toml or requirements-dev.txt
├─ setup.cfg or tox.ini (optional)
├─ .gitignore
└─ README.md



Environment isolation and dependency management
Choose one of two approaches.
Option A Use Python venv and pip
- Create project directory and venv:
python -m venv .venv
source .venv/bin/activate
- Upgrade pip and install dev deps:
pip install --upgrade pip setuptools wheel
pip install fastapi uvicorn pytest pytest-asyncio httpx "openapi-python-client" black isort flake8 mypy pre-commit
- Freeze pinned dev dependencies for reproducibility:
pip freeze > requirements-dev.txt


Option B Use Poetry (recommended for reproducible installs)
- Install Poetry and initialize:
curl -sSL https://install.python-poetry.org | python -
poetry new my-api --src
cd my-api
poetry env use python
poetry add fastapi uvicorn
poetry add --dev pytest pytest-asyncio httpx openapi-python-client black isort flake8 mypy pre-commit
- Use poetry run to execute commands inside the virtualenv:
poetry run pytest



Dev dependencies and best practices
- Formatters: black, isort
- Linters and type checking: flake8, mypy
- Tests: pytest, pytest-asyncio, httpx (async test client)
- Client generator: openapi-python-client or openapi-generator-cli
- Pre-commit hooks: configure pre-commit to run black/isort/flake8/mypy on commit
- Keep dev dependencies separate from runtime dependencies in pyproject or requirements-dev.txt
- Pin versions in a lock file (poetry.lock or requirements-dev.txt)

TDD workflow rules
- Write a failing test for the feature in tests/ (start with the smallest behavior).
- Run pytest and confirm the test fails.
- Implement minimal code to make the test pass.
- Run pytest until all tests pass.
- Refactor if needed while keeping tests green.
- Commit only passing code and updated tests.

Example healthcheck TDD cycle
Create test first at tests/test_health.py:
import pytest
from httpx import AsyncClient
from my_api.main import app

@pytest.mark.asyncio
async def test_healthcheck_returns_200_and_payload():
    async with AsyncClient(app=app, base_url="http://test") as ac:
        r = await ac.get("/health")
    assert r.status_code == 200
    assert r.json() == {"status": "ok"}


Run tests (they will fail because we have no implementation):
pytest -q


Implement minimal FastAPI app to satisfy the test at src/my_api/main.py:
from fastapi import FastAPI
from .api.health import router as health_router

app = FastAPI(title="My API")

app.include_router(health_router)


Create health router at src/my_api/api/health.py:
from fastapi import APIRouter
from fastapi.responses import JSONResponse

router = APIRouter()

@router.get("/health", summary="Healthcheck", tags=["health"])
async def healthcheck():
    return JSONResponse({"status": "ok"})


Run tests again:
pytest -q


All tests should pass.

OpenAPI client generation and autogenerated docs
- FastAPI exposes OpenAPI at /openapi.json and interactive docs at /docs and /redoc by default. Use those for initial inspection.
- To autogenerate a typed Python client from the OpenAPI spec use openapi-python-client:
# Fetch openapi.json into openapi.json
curl -sSL http://127.0.0.1:8000/openapi.json -o openapi.json
# Generate client
openapi-python-client generate --path openapi.json --output ./clients/my_api_client
- Alternatively use openapi-generator-cli for other languages:
openapi-generator-cli generate -i openapi.json -g python -o ./clients/my_api_client
- Add generation step to a small script or Makefile target:
gen-client:
    curl -sSL http://127.0.0.1:8000/openapi.json -o openapi.json
    openapi-python-client generate --path openapi.json --output ./clients/my_api_client



Autogenerating documentation for the project
- Use FastAPI's built-in docs for runtime API documentation on /docs and /redoc.
- For static project docs, consider MkDocs with mkdocstrings or Sphinx:
- Use mkdocs for markdown docs and publish on GitHub Pages.
- Include an automated job that builds docs from the running server's OpenAPI or the source docstrings.
- Example Makefile target to export HTML docs using Redoc CLI:
export-openapi:
    curl -sSL http://127.0.0.1:8000/openapi.json -o openapi.json

redoc-html:
    npx redoc-cli bundle openapi.json -o docs/openapi.html



Git initialization and repository hygiene
- Initialize git, add .gitignore, and make first commit:
git init
echo ".venv/" > .gitignore
echo "__pycache__/" >> .gitignore
echo ".pytest_cache/" >> .gitignore
echo "clients/" >> .gitignore
git add .
git commit -m "chore: initial project layout and tests"
- Keep generated clients and virtualenv out of repo; commit generator config (openapi.json or generator config) instead if desired.

Pre-commit configuration (example)
Create .pre-commit-config.yaml:
repos:
- repo: https
