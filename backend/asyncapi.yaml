asyncapi: 3.0.0
info:
  title: Trading API WebSocket
  version: 1.0.0
  description: |
    Real-time WebSocket API for trading data including market prices, order books, 
    trades, account updates, and notifications.
  contact:
    name: Trading API Support
    email: support@tradingapi.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  development:
    host: localhost:8000
    protocol: ws
    description: Development server
    pathname: /api/v1/ws/v1
  production:
    host: api.tradingpro.com
    protocol: wss
    description: Production server
    pathname: /api/v1/ws/v1

channels:
  market_data:
    description: Real-time market price updates
    messages:
      market_tick:
        $ref: '#/components/messages/MarketDataTick'
    parameters:
      symbol:
        description: Symbol to subscribe to
        schema:
          type: string
          examples:
            - AAPL
            - GOOGL
            - TSLA

  orderbook:
    description: Order book depth updates
    messages:
      orderbook_update:
        $ref: '#/components/messages/OrderBookUpdate'
    parameters:
      symbol:
        description: Symbol to subscribe to
        schema:
          type: string

  trades:
    description: Recent trade updates
    messages:
      trade:
        $ref: '#/components/messages/TradeUpdate'
    parameters:
      symbol:
        description: Symbol to subscribe to
        schema:
          type: string

  chart_data:
    description: Real-time chart/candlestick data
    messages:
      candlestick:
        $ref: '#/components/messages/CandlestickUpdate'
    parameters:
      symbol:
        description: Symbol to subscribe to
        schema:
          type: string
      resolution:
        description: Time resolution
        schema:
          type: string
          enum: [1m, 5m, 15m, 1h, 1D]

  account:
    description: Account balance and status updates (requires authentication)
    messages:
      balance_update:
        $ref: '#/components/messages/BalanceUpdate'

  positions:
    description: Position updates (requires authentication)
    messages:
      position_update:
        $ref: '#/components/messages/PositionUpdate'

  orders:
    description: Order status updates (requires authentication)
    messages:
      order_update:
        $ref: '#/components/messages/OrderUpdate'

  notifications:
    description: Trading notifications and alerts (requires authentication)
    messages:
      notification:
        $ref: '#/components/messages/TradingNotification'

  system:
    description: System status and maintenance messages
    messages:
      system:
        $ref: '#/components/messages/SystemMessage'

  heartbeat:
    description: Connection health monitoring
    messages:
      heartbeat:
        $ref: '#/components/messages/HeartbeatMessage'

operations:
  subscribeMarketData:
    action: send
    channel:
      $ref: '#/channels/market_data'
    summary: Subscribe to market data updates
    description: Subscribe to real-time price updates for specific symbols
    message:
      $ref: '#/components/messages/SubscriptionRequest'

  subscribeOrderBook:
    action: send
    channel:
      $ref: '#/channels/orderbook'
    summary: Subscribe to order book updates
    description: Subscribe to order book depth updates for specific symbols
    message:
      $ref: '#/components/messages/SubscriptionRequest'

  authenticateConnection:
    action: send
    summary: Authenticate WebSocket connection
    description: Authenticate connection using JWT token for private channels
    message:
      $ref: '#/components/messages/AuthenticationMessage'

  receiveMarketData:
    action: receive
    channel:
      $ref: '#/channels/market_data'
    summary: Receive market data updates
    message:
      $ref: '#/components/messages/MarketDataTick'

  receiveOrderBook:
    action: receive
    channel:
      $ref: '#/channels/orderbook'
    summary: Receive order book updates
    message:
      $ref: '#/components/messages/OrderBookUpdate'

components:
  messages:
    SubscriptionRequest:
      name: SubscriptionRequest
      title: Subscription Request
      summary: Request to subscribe/unsubscribe from a channel
      contentType: application/json
      payload:
        $ref: '#/components/schemas/WebSocketSubscription'

    AuthenticationMessage:
      name: AuthenticationMessage
      title: Authentication Message
      summary: WebSocket authentication message
      contentType: application/json
      payload:
        $ref: '#/components/schemas/AuthenticationMessage'

    MarketDataTick:
      name: MarketDataTick
      title: Market Data Tick
      summary: Real-time market price update
      contentType: application/json
      payload:
        $ref: '#/components/schemas/MarketDataTick'

    OrderBookUpdate:
      name: OrderBookUpdate
      title: Order Book Update
      summary: Order book depth update
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrderBookUpdate'

    TradeUpdate:
      name: TradeUpdate
      title: Trade Update
      summary: Individual trade update
      contentType: application/json
      payload:
        $ref: '#/components/schemas/TradeUpdate'

    CandlestickUpdate:
      name: CandlestickUpdate
      title: Candlestick Update
      summary: Real-time candlestick/bar update
      contentType: application/json
      payload:
        $ref: '#/components/schemas/CandlestickUpdate'

    BalanceUpdate:
      name: BalanceUpdate
      title: Balance Update
      summary: Account balance update
      contentType: application/json
      payload:
        $ref: '#/components/schemas/BalanceUpdate'

    PositionUpdate:
      name: PositionUpdate
      title: Position Update
      summary: Position update message
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PositionUpdate'

    OrderUpdate:
      name: OrderUpdate
      title: Order Update
      summary: Order status update
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrderUpdate'

    TradingNotification:
      name: TradingNotification
      title: Trading Notification
      summary: Trading notification message
      contentType: application/json
      payload:
        $ref: '#/components/schemas/TradingNotification'

    SystemMessage:
      name: SystemMessage
      title: System Message
      summary: System status or maintenance message
      contentType: application/json
      payload:
        $ref: '#/components/schemas/SystemMessage'

    HeartbeatMessage:
      name: HeartbeatMessage
      title: Heartbeat Message
      summary: Heartbeat/ping message for connection health
      contentType: application/json
      payload:
        $ref: '#/components/schemas/HeartbeatMessage'

  schemas:
    WebSocketSubscription:
      type: object
      required:
        - action
        - channel
      properties:
        action:
          type: string
          enum: [subscribe, unsubscribe]
          description: Subscription action
        channel:
          type: string
          description: Channel to subscribe/unsubscribe
        symbol:
          type: string
          description: Symbol filter (if applicable)
        params:
          type: object
          description: Additional parameters

    AuthenticationMessage:
      type: object
      required:
        - type
        - timestamp
        - channel
        - token
      properties:
        type:
          type: string
          const: auth
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: auth
        token:
          type: string
          description: JWT authentication token

    MarketDataTick:
      type: object
      required:
        - type
        - timestamp
        - channel
        - symbol
        - price
      properties:
        type:
          type: string
          const: market_tick
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: market_data
        symbol:
          type: string
          description: Symbol name
        price:
          type: number
          format: float
          description: Current price
        volume:
          type: integer
          description: Volume
        bid:
          type: number
          format: float
          description: Bid price
        ask:
          type: number
          format: float
          description: Ask price
        change:
          type: number
          format: float
          description: Price change
        change_percent:
          type: number
          format: float
          description: Price change percentage

    OrderBookUpdate:
      type: object
      required:
        - type
        - timestamp
        - channel
        - symbol
        - bids
        - asks
        - sequence
      properties:
        type:
          type: string
          const: orderbook_update
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: orderbook
        symbol:
          type: string
          description: Symbol name
        bids:
          type: array
          description: Bid orders [price, quantity]
          items:
            type: array
            items:
              type: number
            minItems: 2
            maxItems: 2
        asks:
          type: array
          description: Ask orders [price, quantity]
          items:
            type: array
            items:
              type: number
            minItems: 2
            maxItems: 2
        sequence:
          type: integer
          description: Sequence number for ordering

    TradeUpdate:
      type: object
      required:
        - type
        - timestamp
        - channel
        - symbol
        - price
        - quantity
        - side
        - trade_id
      properties:
        type:
          type: string
          const: trade
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: trades
        symbol:
          type: string
          description: Symbol name
        price:
          type: number
          format: float
          description: Trade price
        quantity:
          type: number
          format: float
          description: Trade quantity
        side:
          type: string
          enum: [buy, sell]
          description: Trade side
        trade_id:
          type: string
          description: Unique trade ID

    CandlestickUpdate:
      type: object
      required:
        - type
        - timestamp
        - channel
        - symbol
        - resolution
        - time
        - open
        - high
        - low
        - close
        - is_final
      properties:
        type:
          type: string
          const: candlestick
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: chart_data
        symbol:
          type: string
          description: Symbol name
        resolution:
          type: string
          description: Time resolution
        time:
          type: integer
          description: Bar timestamp (milliseconds)
        open:
          type: number
          format: float
          description: Open price
        high:
          type: number
          format: float
          description: High price
        low:
          type: number
          format: float
          description: Low price
        close:
          type: number
          format: float
          description: Close price
        volume:
          type: integer
          description: Volume
        is_final:
          type: boolean
          description: Whether this bar is final or updating

    BalanceUpdate:
      type: object
      required:
        - type
        - timestamp
        - channel
        - asset
        - available
        - locked
        - total
      properties:
        type:
          type: string
          const: balance_update
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: account
        asset:
          type: string
          description: Asset symbol (USD, BTC, etc.)
        available:
          type: number
          format: float
          description: Available balance
        locked:
          type: number
          format: float
          description: Locked balance
        total:
          type: number
          format: float
          description: Total balance

    PositionUpdate:
      type: object
      required:
        - type
        - timestamp
        - channel
        - symbol
        - side
        - size
        - entry_price
        - mark_price
        - unrealized_pnl
        - realized_pnl
      properties:
        type:
          type: string
          const: position_update
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: positions
        symbol:
          type: string
          description: Symbol name
        side:
          type: string
          enum: [long, short]
          description: Position side
        size:
          type: number
          format: float
          description: Position size
        entry_price:
          type: number
          format: float
          description: Average entry price
        mark_price:
          type: number
          format: float
          description: Current mark price
        unrealized_pnl:
          type: number
          format: float
          description: Unrealized P&L
        realized_pnl:
          type: number
          format: float
          description: Realized P&L

    OrderUpdate:
      type: object
      required:
        - type
        - timestamp
        - channel
        - order_id
        - symbol
        - side
        - order_type
        - status
        - quantity
        - filled_quantity
      properties:
        type:
          type: string
          const: order_update
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: orders
        order_id:
          type: string
          description: Order ID
        symbol:
          type: string
          description: Symbol name
        side:
          type: string
          enum: [buy, sell]
          description: Order side
        order_type:
          type: string
          enum: [market, limit, stop, stop_limit]
          description: Order type
        status:
          type: string
          enum: [pending, open, filled, cancelled, rejected]
          description: Order status
        quantity:
          type: number
          format: float
          description: Order quantity
        filled_quantity:
          type: number
          format: float
          description: Filled quantity
        price:
          type: number
          format: float
          description: Order price (for limit orders)
        average_fill_price:
          type: number
          format: float
          description: Average fill price

    TradingNotification:
      type: object
      required:
        - type
        - timestamp
        - channel
        - category
        - title
        - message
      properties:
        type:
          type: string
          const: notification
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: notifications
        category:
          type: string
          enum: [info, warning, error, success]
          description: Notification category
        title:
          type: string
          description: Notification title
        message:
          type: string
          description: Notification message
        data:
          type: object
          description: Additional notification data

    SystemMessage:
      type: object
      required:
        - type
        - timestamp
        - channel
        - event
        - message
      properties:
        type:
          type: string
          const: system
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: system
        event:
          type: string
          enum: [maintenance, service_update, market_hours]
          description: System event type
        message:
          type: string
          description: System message
        data:
          type: object
          description: Additional system data

    HeartbeatMessage:
      type: object
      required:
        - type
        - timestamp
        - channel
        - server_time
      properties:
        type:
          type: string
          const: heartbeat
        timestamp:
          type: string
          format: date-time
        channel:
          type: string
          const: heartbeat
        server_time:
          type: string
          format: date-time
          description: Server timestamp

  securitySchemes:
    jwtAuth:
      type: httpApiKey
      name: Authorization
      in: header
      description: JWT token for authenticated channels